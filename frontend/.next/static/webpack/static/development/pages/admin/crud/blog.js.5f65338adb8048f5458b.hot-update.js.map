{"version":3,"file":"static/webpack/static\\development\\pages\\admin\\crud\\blog.js.5f65338adb8048f5458b.hot-update.js","sources":["webpack:///./components/crud/BlogCreate.js"],"sourcesContent":["import Link from \"next/link\";\r\nimport { useState, useEffect } from \"react\";\r\nimport Router from \"next/router\";\r\nimport dynamic from \"next/dynamic\";\r\nimport { withRouter } from \"next/router\";\r\nimport { getCookie, isAuth } from \"../../actions/auth\";\r\nimport { getCategories } from \"../../actions/category\";\r\nimport { getTags } from \"../../actions/tag\";\r\nimport { createBlog } from \"../../actions/blog\";\r\nimport { QuillFormats, QuillModules } from \"../../helpers/quill\";\r\n\r\nconst ReactQuill = dynamic(() => import(\"react-quill\"), { ssr: false });\r\n\r\nconst BlogCreate = ({ router }) => {\r\n  const blogFromLS = () => {\r\n    if (typeof window === \"undefined\") {\r\n      return false;\r\n    }\r\n    if (localStorage.getItem(\"blog\")) {\r\n      // convert data to javascript\r\n      return JSON.parse(localStorage.getItem(\"blog\"));\r\n    } else {\r\n      return false;\r\n    }\r\n  };\r\n  const [categories, setCategories] = useState([]);\r\n  const [tags, setTags] = useState([]);\r\n\r\n  const [checked, setChecked] = useState([]);\r\n  const [checkedTag, setCheckedTag] = useState([]);\r\n\r\n  const [body, setBody] = useState(blogFromLS());\r\n  const [values, setValues] = useState({\r\n    error: \"\",\r\n    sizeError: \"\",\r\n    success: \"\",\r\n    formData: \"\",\r\n    title: \"\",\r\n    hidePublishButton: false\r\n  });\r\n\r\n  const { error, sizeError, success, formData, title, hidePublishButton } = values;\r\n  const token = getCookie(\"token\");\r\n  const existingBody = localStorage.getItem(\"blog\");\r\n  console.log(existingBody);\r\n\r\n  useEffect(() => {\r\n    setValues({ ...values, formData: new FormData() });\r\n    setBody({ ...body });\r\n    initCategories();\r\n    initTags();\r\n  }, [router]);\r\n\r\n  const initCategories = () => {\r\n    getCategories().then(data => {\r\n      if (data.error) {\r\n        setValues({ ...values, error: data.error });\r\n      } else {\r\n        setCategories(data);\r\n      }\r\n    });\r\n  };\r\n\r\n  const initTags = () => {\r\n    getTags().then(data => {\r\n      if (data.error) {\r\n        setValues({ ...values, error: data.error });\r\n      } else {\r\n        setTags(data);\r\n      }\r\n    });\r\n  };\r\n\r\n  // console.log(router);\r\n  const publishBlog = e => {\r\n    e.preventDefault();\r\n\r\n    createBlog(formData, token).then(data => {\r\n      if (data.error) {\r\n        setValues({ ...values, error: data.error });\r\n      } else {\r\n        setValues({\r\n          ...values,\r\n          title: \"\",\r\n          error: \"\",\r\n          success: `A new blog title \"${data.title}\" is created`\r\n        });\r\n        setBody(\"\");\r\n        setCategories([]);\r\n        setTags([]);\r\n        initCategories();\r\n        initTags();\r\n      }\r\n    });\r\n    console.log(\"ready to publishBlog\");\r\n  };\r\n  // photo file handler\r\n  const titlePhotoHandller = name => e => {\r\n    // console.log(e.target.value);\r\n    const value = name === \"photo\" ? e.target.files[0] : e.target.value;\r\n    formData.set(name, value);\r\n    setValues({ ...values, [name]: value, formData, error: \"\" });\r\n  };\r\n\r\n  const handleBody = e => {\r\n    // console.log(e);\r\n    setBody(e);\r\n    formData.set(\"body\", e);\r\n    if (typeof window !== \"undefined\") {\r\n      localStorage.setItem(\"blog\", JSON.stringify(e));\r\n    }\r\n  };\r\n\r\n  const categoryToggleHandller = id => () => {\r\n    setValues({ ...values, error: \"\" });\r\n    const clickedCategories = [...checked];\r\n    const indexOfClickedCategory = checked.indexOf(id);\r\n    if (indexOfClickedCategory === -1) {\r\n      clickedCategories.push(id);\r\n    } else {\r\n      clickedCategories.splice(indexOfClickedCategory, 1);\r\n    }\r\n    setChecked(clickedCategories);\r\n    formData.set(\"categories\", clickedCategories);\r\n  };\r\n\r\n  const tagToggleHandller = id => () => {\r\n    setValues({ ...values, error: \"\" });\r\n    const clickedTags = [...checkedTag];\r\n    const indexOfClickedTag = checkedTag.indexOf(id);\r\n    if (indexOfClickedTag === -1) {\r\n      clickedTags.push(id);\r\n    } else {\r\n      clickedTags.splice(indexOfClickedTag, 1);\r\n    }\r\n    setCheckedTag(clickedTags);\r\n    console.log(clickedTags);\r\n    formData.set(\"tags\", clickedTags);\r\n  };\r\n\r\n  const showCategories = () => {\r\n    return (\r\n      categories &&\r\n      categories.map((c, i) => (\r\n        <li key={i} className=\"list-unstyled\">\r\n          <input onChange={categoryToggleHandller(c._id)} type=\"checkbox\" className=\"mr-2\" />\r\n          <label className=\"form-check-label\">{c.name}</label>\r\n        </li>\r\n      ))\r\n    );\r\n  };\r\n\r\n  const showTags = () => {\r\n    return (\r\n      tags &&\r\n      tags.map((t, i) => (\r\n        <li key={i} className=\"list-unstyled\">\r\n          <input onChange={tagToggleHandller(t._id)} type=\"checkbox\" className=\"mr-2\" />\r\n          <label className=\"form-check-label\">{t.name}</label>\r\n        </li>\r\n      ))\r\n    );\r\n  };\r\n\r\n  const showError = () => (\r\n    <div className=\"alert alert-danger\" style={{ display: error ? \"\" : \"none\" }}>\r\n      {error}\r\n    </div>\r\n  );\r\n  const showSuccess = () => (\r\n    <div className=\"alert alert-success\" style={{ display: success ? \"\" : \"none\" }}>\r\n      {success}\r\n    </div>\r\n  );\r\n\r\n  const createBlogForm = () => {\r\n    return (\r\n      <form onSubmit={publishBlog}>\r\n        <div className=\"form-group\">\r\n          <label className=\"text-muted\">Title</label>\r\n          <input type=\"text\" className=\"form-control\" onChange={titlePhotoHandller(\"title\")} />\r\n        </div>\r\n        <div className=\"form-group\">\r\n          <ReactQuill\r\n            modules={QuillModules}\r\n            formats={QuillFormats}\r\n            value={body}\r\n            placeholder=\"Write something amazing...\"\r\n            onChange={handleBody}\r\n          />\r\n        </div>\r\n        <div>\r\n          <button className=\"btn btn-primary\">Publish</button>\r\n        </div>\r\n      </form>\r\n    );\r\n  };\r\n  return (\r\n    <div className=\"container-fluid pb-5\">\r\n      <div className=\"row\">\r\n        <div className=\"col-md-8\">\r\n          {createBlogForm()}\r\n          <div className=\"pt-3\">\r\n            {showError()}\r\n            {showSuccess()}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"col-md-4\">\r\n          <div className=\"form-group pb-2\">\r\n            <h5>Featured image</h5>\r\n            <hr />\r\n\r\n            <label className=\"btn btn-outline-info\">\r\n              Upload featured image\r\n              <input onChange={titlePhotoHandller(\"photo\")} type=\"file\" accept=\"image/*\" hidden />\r\n            </label>\r\n            <small className=\"text-muted\"> Max size:1 Mb</small>\r\n          </div>\r\n          <div>\r\n            <h5>Categories</h5>\r\n            <hr />\r\n            <ul style={{ maxHeight: \"200px\", overflowY: \"scroll\" }}>{showCategories()}</ul>\r\n          </div>\r\n          <div>\r\n            <h5>Tags</h5>\r\n            <hr />\r\n            <ul style={{ maxHeight: \"200px\", overflowY: \"scroll\" }}>{showTags()}</ul>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default withRouter(BlogCreate);\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AACA,iBAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAoBA;AACA;AACA;AACA;AACA;AACA;AANA;AAnBA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AA6BA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AALA;AACA;AAMA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAXA;AACA;AAYA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAZA;AACA;AAaA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;AAOA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;AAOA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AACA;AAIA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AACA;AAKA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AACA;AACA;;;;A","sourceRoot":""}